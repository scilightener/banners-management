## Что это
- REST-микросервис, написанный на Go, для управления баннерами (CRUD). Что такое баннер и другие вводные см. в [общих вводных](#общие-вводные)
- Postgres использовался в качестве персистентного хранилища данных, и Redis для кэширования
- Подробное описание API интерфейса дано в документации openapi: `docs/openapi`. Ознакомиться со схемой онлайн можно на сайте [swaggerhub](https://app.swaggerhub.com/apis/NIKITALBOSS/banners-management/v1).

## Команды запуска в Makefile:
- `make docker` - запуск всего приложения и его зависимостей в докер-среде. Для запуска нужен докер. Чтобы отменить - `make docker-down`
- `make run` - локальный запуск проекта (только самого go-приложения). Для запуска нужен postgres, слушающий на 5432 порту, с настроенной политикой безопасности подключений, а также redis на порту 6379 с настроенными кредами для подключения. Эта команда используется в основном для локальной разработки. Для запуска нужен go версии >= 1.22.1
- `make migrate-up` - применяет все миграции для локальной БД (`make migrate-down` для отмены)
- `make docker-deps` - запускает все зависимости в докере. Само go-приложение нужно запускать отдельно. Используется в сочетании с `make run-docker-deps` или для дебага тестов. Чтобы отменить - `make docker-deps-down`
- `make lint` - запуск линтера для кода всего проекта. Для этого локально должен быть установлен golangci-lint. Конфигурация линтера описана в файле `config/.golangci.yml`
- `make test` - запускает тесты, предварительно подняв в докере все зависимости. Для запуска нужен докер. После того, как все тесты завершили свою работу, контейнер с зависимостями в докере автоматически останавливается и удаляется
- `make jwt-user` - получение пользовательского jwt-токена
- `make jwt-admin` - получение админского jwt-токена

## Общие вводные
- Баннер — это JSON-документ, состоящий из полей title, text, url. Тег — это сущность для обозначения группы пользователей; представляет собой число (ID тега).  Фича — это домен или функциональность; представляет собой число (ID фичи).

1. Один баннер может быть связан только с одной фичей и несколькими тегами.
2. При этом один тег, как и одна фича, могут принадлежать разным баннерам одновременно.
3. Фича и тег однозначно определяют баннер

## Фичи и замечания
- Для авторизации доступны 2 вида токенов: пользовательский и админский. Получение баннера может происходить с помощью пользовательского или админского токена, а все остальные действия могут выполняться только с помощью админского токена. Получение токена с нужной ролью возможно через эндпоинт `/token?role=<role>` (используется исключительно в целях упрощения получения jwt с нужной ролью) .
- Если при получении баннера передан флаг use_last_revision, отдаётся самая актуальная информация. В ином случае допускается передача информации, которая была актуальна 5 минут назад. Для реализации кэширования на уровне приложения был выбран redis. В нём сохраняются последние запросы пользователей на баннеры.
- Баннеры могут быть временно выключены (поле is_active). Если баннер выключен, то обычные пользователи не могут его получать, при этом у админов есть к нему полный доступ.
- Поддерживается метод удаления баннеров по фиче или тегу, время ответа которого константно и не зависит от текущего количества баннеров (реализован механизм выполнения отложенных действий). Для реализации механизма выполнения отложенных действий был использован redis, а конкретно его функциональность каналов.
- К проекту приложена коллекция postman для удобства тестирования (`docs/banners-management.postman_collection.json`).
- Интеграционными тестами (`tests/`) покрыто большинство сценариев работы приложения. Для их запуска необходимо, чтобы были подняты все внешние зависимости приложения (см. `make docker-deps`).
- К проекту приложен конфиг линтера golangci-lint, рекомендациям которого код строго соответствует.
- Настроен запуск github workflow на каждый push в ветку main данного репозитория. Workflow запускает проверку линтера, тесты, а затем деплой на удалённый сервер с разворачиванием на нём docker-контейнера с приложением. Развёрнутый сервис доступен по адресу: http://5.42.100.122:22313 (не дудосьте пожалусто умоляю прошу).
